openapi: 3.0.4
info:
  title: Clothica Shop API
  description: >
    API для інтернет-магазину Clothica.
    Тут описано всі доступні ендпоінти для роботи з користувачами, товарами, замовленнями, категоріями, відгуками та підписками.
    Підтримуються як публічні, так і приватні маршрути з авторизацією через cookie.
  version: 1.0.1

servers:
  - url: https://dream-backend-a69s.onrender.com/

paths:
  /api/auth/register:
    post:
      summary: Реєстрація нового користувача
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - phone
                - password
              properties:
                name:
                  type: string
                  example: 'Sergiy'
                phone:
                  type: string
                  pattern: '^\\+380\\d{9}$'
                  example: '+380971234567'
                password:
                  type: string
                  example: 'securePassword123'
      responses:
        '201':
          description: Користувача успішно створено
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Користувача успішно створено'
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Цей номер телефону вже використовується

  /api/auth/login:
    post:
      summary: Вхід користувача
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - phone
                - password
              properties:
                phone:
                  type: string
                  example: '+380971234567'
                password:
                  type: string
                  example: 'securePassword123'
      responses:
        '200':
          description: Вхід виконано успішно
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Вхід виконано успішно'
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Невірний номер телефону або пароль

  /api/auth/logout:
    post:
      summary: Вихід користувача
      tags:
        - Auth
      responses:
        '204':
          description: Вихід успішний

  /api/auth/refresh:
    post:
      summary: Оновлення сесії користувача
      tags:
        - Auth
      responses:
        '200':
          description: Session refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Session refreshed'
        '401':
          description: Session not found

  /api/users/current:
    get:
      summary: Отримати інформацію про поточного користувача
      tags:
        - Users
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Дані користувача
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Missing access token

    patch:
      summary: Оновлення даних користувача
      tags:
        - Users
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: 'Oleksii'
                surname:
                  type: string
                  example: 'Ivanenko'
                phone:
                  type: string
                  example: '+380971234566'
      responses:
        '200':
          description: Дані оновлені
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdatedUserResponse'
        '401':
          description: Missing access token

  /api/categories:
    get:
      summary: Отримати список категорій з пагінацією
      tags:
        - Categories
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Список категорій
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /api/goods:
    get:
      summary: Отримати список товарів з фільтрами та пагінацією
      tags:
        - Goods
      parameters:
        - in: query
          name: categoryId
          schema:
            type: string
        - in: query
          name: priceMin
          schema:
            type: number
        - in: query
          name: priceMax
          schema:
            type: number
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Список товарів
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Good'

  /api/goods/{id}:
    get:
      summary: Отримати деталі товару за ID
      tags:
        - Goods
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Деталі товару
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Good'
        '404':
          description: Good not found

  /api/orders:
    post:
      summary: Оформлення замовлення
      tags:
        - Orders
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
      responses:
        '201':
          description: Замовлення створено успішно
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Невірні дані або помилка оформлення
        '401':
          description: Missing access token

  /api/orders/my:
    get:
      summary: Отримати всі замовлення користувача
      tags:
        - Orders
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Список замовлень користувача
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
        '401':
          description: Missing access token

  /api/orders/{id}/status:
    patch:
      summary: Зміна статусу замовлення (тільки admin)
      tags:
        - Orders
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  example: 'shipped'
      responses:
        '200':
          description: Статус замовлення оновлено
        '403':
          description: Access denied. Admins only.

  /api/feedbacks:
    post:
      summary: Створення відгуку
      tags:
        - Feedbacks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackInput'
      responses:
        '201':
          description: Відгук створено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Feedback'
        '400':
          description: Validation failed

    get:
      summary: Отримати список відгуків
      tags:
        - Feedbacks
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Список відгуків
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Feedback'

  /api/subscriptions:
    post:
      summary: Створення запиту на підписку
      tags:
        - Subscriptions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: 'user@example.com'
      responses:
        '201':
          description: Підписка створена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          description: Validation failed

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: accessToken

  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
          example: '64f5b1c8b6e1f9a123456789'
        name:
          type: string
          example: 'Sergiy'
        surname:
          type: string
          example: 'Ivanenko'
        phone:
          type: string
          example: '+380971234567'
        role:
          type: string
          example: 'user'

    UpdatedUserResponse:
      allOf:
        - $ref: '#/components/schemas/User'
      example:
        _id: '64fcadca3b03df2c7a1cba12'
        name: 'Oleksii'
        surname: 'Ivanenko'
        phone: '+380971234566'
        role: 'user'
        updatedAt: '2025-11-11T09:12:32.000Z'

    Category:
      type: object
      properties:
        _id:
          type: string
          example: '690c9ce6a6276289c98fc006'
        name:
          type: string
          example: 'Футболки та сорочки'

    Good:
      type: object
      properties:
        _id:
          type: string
          example: '6877b9f116ae59c7b60d0107'
        name:
          type: string
          example: "Світшот 'Minimal Black'"
        category:
          type: string
          example: '690c9ce6a6276289c98fc006'
        image:
          type: string
          example: 'https://ftp.goit.study/img/goods/6877b9f116ae59c7b60d0107.webp'
        price:
          type: object
          properties:
            value:
              type: number
              example: 1299
            currency:
              type: string
              example: 'грн'
        size:
          type: array
          items:
            type: string
          example: ['XL', 'XS', 'S', 'M', 'L', 'XXL']
        description:
          type: string
          example: 'Світшот Minimal Black — втілення стриманості та універсальності. Його дизайн побудований на простоті: глибокий чорний колір, акуратний круглий виріз і прямий крій. Тканина — м’який трикотаж із високим вмістом бавовни, що забезпечує комфорт у щоденному носінні. Завдяки універсальному стилю цей світшот легко поєднується як зі спортивним одягом, так і з джинсами чи навіть класичними брюками. Його можна використовувати як базовий шар під куртку або носити самостійно. Модель не має зайвих деталей, проте саме ця мінімалістичність робить її актуальною та довговічною. Minimal Black — це стильний вибір для тих, хто цінує простоту й практичність.'
        feedbacks:
          type: array
          items:
            type: string
          example: ['64f5b1c8b6e1f9a123456789']
        prevDescription:
          type: string
          example: 'Світшот Minimal Black — втілення стриманості. Глибокий чорний колір, акуратний крій та м'яка тканина (трикотаж з високим вмістом бавовни) забезпечують комфорт. Ця базова річ універсальна: пасує до джинсів, спортивного одягу чи класичних брюк. Ідеальний вибір.'
        gender:
          type: string
          example: 'unisex'
        characteristics:
          type: array
          items:
            type: string
          example: ['Матеріал: 80% бавовна, 20% поліестер', 'Крій: прямий', 'Горловина: круглий виріз', 'Сезон: Осінь/Зима/Весна']

    OrderGoodsItem:
      type: object
      properties:
        productId:
          type: string
          example: '671fbb85ec7f5f1d6b65f2a9'
        title:
          type: string
          example: 'Сорочка чоловіча'
        quantity:
          type: integer
          example: 2
        price:
          type: number
          example: 850
        total:
          type: number
          example: 1700

    OrderInput:
      type: object
      required:
        - goods
        - name
        - surname
        - phone
        - city
        - postNumber
      properties:
        goods:
          type: array
          description: Список товарів у замовленні
          items:
            $ref: '#/components/schemas/OrderGoodsItem'
        name:
          type: string
          example: 'Олексій'
        surname:
          type: string
          example: 'Іваненко'
        phone:
          type: string
          example: '+380971234567'
        city:
          type: string
          example: 'Київ'
        postNumber:
          type: string
          example: '12'
        comment:
          type: string
          example: 'Доставити у другій половині дня'

    OrderResponse:
      type: object
      properties:
        message:
          type: string
          example: 'Order created successfully'
        order:
          type: object
          properties:
            _id:
              type: string
              example: '6732aa88b9c5df1234567890'
            goods:
              type: array
              items:
                $ref: '#/components/schemas/OrderGoodsItem'
            totalAmount:
              type: number
              example: 1700
            status:
              type: string
              example: 'pending'
            userId:
              type: string
              example: '672ff3e71c8b1d1234a56789'
            createdAt:
              type: string
              format: date-time
              example: '2025-11-11T19:35:00.000Z'

    Order:
      type: object
      properties:
        _id:
          type: string
          example: '69135246d77bd9a8f9389459'
        userId:
          type: string
          example: '64f5b1c8b6e1f9a123456789'
        goods:
          type: array
          items:
            $ref: '#/components/schemas/OrderGoodsItem'
        status:
          type: string
          example: 'pending'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    FeedbackInput:
      type: object
      required:
        - userId
        - message
        - rate
        - category
        - productId
      properties:
        userId:
          type: string
          example: '64f5b1c8b6e1f9a123456789'
        message:
          type: string
          example: 'Чудовий світшот, дуже зручно носити.'
        rate:
          type: number
          example: 5
        category:
          type: string
          example: 'Футболки та сорочки'
        productId:
          type: string
          example: '6877b9f116ae59c7b60d0107'

    Feedback:
      type: object
      properties:
        author:
          type: string
          example: 'Sergiy Ivanenko'
        description:
          type: string
          example: 'Чудовий світшот, дуже зручно носити.'
        rate:
          type: number
          example: 5
        category:
          type: string
          example: 'Футболки та сорочки'
        productId:
          type: string
          example: '6877b9f116ae59c7b60d0107'
        _id:
          type: string
          example: '64f5b1c8b6e1f9a123456789'
        createdAt:
          type: string
          example: '2025-11-11T19:35:00.000Z'
        updatedAt:
          type: string
          example: '2025-11-11T19:35:00.000Z'

    Subscription:
      type: object
      properties:
        _id:
          type: string
          example: '690de2a1b6e1f9a123456abc'
        email:
          type: string
          example: 'user@example.com'
        createdAt:
          type: string
          format: date-time
          example: '2025-11-11T18:00:00.000Z'
